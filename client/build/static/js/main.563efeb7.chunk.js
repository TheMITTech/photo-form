(this["webpackJsonptech-photo-form"]=this["webpackJsonptech-photo-form"]||[]).push([[0],{143:function(e,t){function a(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}a.keys=function(){return[]},a.resolve=a,e.exports=a,a.id=143},144:function(e,t){},168:function(e,t,a){},283:function(e,t){},284:function(e,t){},285:function(e,t){},286:function(e,t){},287:function(e,t){},288:function(e,t){},290:function(e,t,a){},291:function(e,t,a){"use strict";a.r(t);var o=a(0),s=a.n(o),n=a(27),l=a.n(n),c=(a(168),a(160)),i=a(47),r=a(33),u=(a.p,a(118)),d=a.n(u),j=d.a.create({baseURL:"https://photo-form.thetech.com"}),m=a(299),b=a(297),h=a(296),f=a(161),O=a(298),p=a(301),g=a(302),x=a(300),v=a(55),I=a(6),T=m.a.Title;m.a.Paragraph,m.a.Text,m.a.Link;function k(e){var t=e.photoData;return Object(I.jsxs)("div",{children:[Object(I.jsx)("img",{src:t.download_url,style:{maxWidth:"100%"}}),Object(I.jsxs)("p",{children:["Uploader: ",t.uploader," ",Object(I.jsx)("br",{}),"Attribution: ",t.attribution," ",Object(I.jsx)("br",{}),"Department: ",t.department," ",Object(I.jsx)("br",{}),"Date Taken: ",t.dt_taken," ",Object(I.jsx)("br",{}),"Caption: ",t.caption," ",Object(I.jsx)("br",{})]})]})}function w(e){var t=Object(o.useState)([]),a=Object(r.a)(t,2),s=a[0],n=a[1],l=Object(o.useState)([]),c=Object(r.a)(l,2),i=c[0],u=c[1],d=Object(o.useState)([]),b=Object(r.a)(d,2),h=b[0],w=b[1];if(Object(o.useEffect)((function(){n(!1),console.log("got default volume ".concat(e.defaultVolume," and issue ").concat(e.defaultIssue)),w({volume:e.defaultVolume,issue:e.defaultIssue})}),[]),Object(o.useEffect)((function(){s&&j.get("photos_by_issue",{params:{volume:h.volume,issue:h.issue}}).then((function(e){return u(e)}))}),[s,h]),!s)return Object(I.jsx)("div",{className:"main-container",children:Object(I.jsx)(O.a,{name:"viewer-password",onFinish:function(e){"techphoto"==e.password?n(!0):f.b.error("Incorrect Password")},children:Object(I.jsx)(O.a.Item,{label:"Password",name:"password",children:Object(I.jsx)(p.a.Password,{})})})});if(i.data&&i.data.length>0)var y=i.data.map((function(e){return Object(I.jsx)(k,{photoData:e})}));else y=Object(I.jsx)("p",{children:"No Photos"});return Object(I.jsxs)("div",{className:"main-container",children:[Object(I.jsx)(m.a,{children:Object(I.jsxs)(T,{children:["Photos for Volume ",h.volume," Issue"," ",h.issue]})}),Object(I.jsx)("h1",{}),Object(I.jsxs)(O.a,{name:"select_issue",onFinish:function(e){w({volume:e.volume?e.volume:h.volume,issue:e.issue?e.issue:h.issue})},children:[Object(I.jsx)("h2",{children:"Choose new issue"}),Object(I.jsxs)(g.b,{children:[Object(I.jsx)(O.a.Item,{label:"Volume",name:"volume",children:Object(I.jsx)(x.a,{defaultValue:h.volume})}),Object(I.jsx)(O.a.Item,{label:"Issue",name:"issue",children:Object(I.jsx)(x.a,{defaultValue:h.issue})}),Object(I.jsx)(O.a.Item,{children:Object(I.jsx)(v.a,{type:"primary",htmlType:"submit",children:"Go"})})]})]}),y]})}var y=a(74),V=a.n(y),P=a(67),D=a(120),S=a(295),F=a(105),L=a.n(F),N=a(156),_=(a(145),Object(N.b)(L.a)),q=a(158),E=(a(292),Object(q.a)(L.a),o.forwardRef((function(e,t){return Object(I.jsx)(_,Object(i.a)(Object(i.a)({},e),{},{picker:"time",mode:void 0,ref:t}))})));E.displayName="TimePicker";var C=m.a.Title,U=(m.a.Paragraph,m.a.Text,m.a.Link,D.a.Option);function R(e){var t=O.a.useForm(),a=Object(r.a)(t,1)[0],o=P(e.imgInfo.date);return console.log(o),console.log(P("2019-11-10T03:53:31-05:00")),Object(I.jsxs)("div",{className:"image-info-form-container",children:[Object(I.jsx)(S.a,{}),Object(I.jsxs)(C,{level:2,children:["Image ",e.itemNum,": ",e.file.name]}),Object(I.jsx)("img",{src:URL.createObjectURL(e.file),className:"image-preview"}),Object(I.jsxs)(O.a,{form:a,onFieldsChange:function(t,a){var s=function(t){return{event_name:t[0].value,department:t[1].value?t[1].value:"fto",volume:t[2].value?t[2].value:e.defaultVolume,issue:t[3].value?t[3].value:e.defaultIssue,dt_taken:t[4].value?t[4].value:o,caption:t[5].value,attribution:t[6].value}}(a);e.handleUpdate(s)},children:[Object(I.jsx)(O.a.Item,{label:"Event/Topic",name:"event",children:Object(I.jsx)(p.a,{placeholder:"Men's Soccer vs. WPI"})}),Object(I.jsxs)(g.b,{children:[Object(I.jsx)(O.a.Item,{label:"Department",name:"department",children:Object(I.jsxs)(D.a,{placeholder:"Select",defaultValue:"fto",children:[Object(I.jsx)(U,{value:"spo",children:"SPO"}),Object(I.jsx)(U,{value:"fto",children:"FTO"}),Object(I.jsx)(U,{value:"rtz",children:"RTZ"}),Object(I.jsx)(U,{value:"cl",children:"CL"})]})}),Object(I.jsx)(O.a.Item,{label:"Volume",name:"volume",children:Object(I.jsx)(x.a,{defaultValue:e.defaultVolume})}),Object(I.jsx)(O.a.Item,{label:"Issue",name:"issue",children:Object(I.jsx)(x.a,{defaultValue:e.defaultIssue})})]}),Object(I.jsx)(O.a.Item,{label:"Date/Time Taken (autofilled from EXIF if available)",name:"datetime",children:Object(I.jsx)(_,{defaultValue:o.isValid()?o:void 0,showTime:!0,disabled:o.isValid()},o)}),Object(I.jsx)(O.a.Item,{label:"Caption",name:"caption",children:Object(I.jsx)(p.a.TextArea,{placeholder:"See the wiki for how to write a good caption"})}),Object(I.jsx)(O.a.Item,{label:"Attribution (or your full name)",name:"attribution",children:Object(I.jsx)(p.a,{placeholder:"Photo Provided by Dance Troupe"})})]})]})}function A(e){var t=Object(o.useState)({}),a=Object(r.a)(t,2),s=(a[0],a[1],Object(o.useState)(null)),n=Object(r.a)(s,2),l=n[0],c=n[1];return Object(o.useEffect)((function(){V.a.getData(e.file,(function(){var e=V.a.getTag(this,"DateTimeOriginal");c(void 0!==e?function(e){var t=e.split(/\D/);return new Date(t[0],t[1]-1,t[2],t[3],t[4],t[5])}(e):null)}))}),[e.file]),Object(I.jsx)(R,Object(i.a)(Object(i.a)({},e),{},{imgInfo:{date:l}}))}a(282);var J=m.a.Title,M=(m.a.Paragraph,m.a.Text,m.a.Link,b.a.Dragger),z=D.a.Option;function W(e){var t,a=O.a.useForm(),s=Object(r.a)(a,1)[0],n=Object(o.useState)(),l=Object(r.a)(n,2),c=l[0],i=l[1];return Object(o.useEffect)((function(){if(c){var t=s.getFieldsValue();if(s.getFieldInstance(),console.log("fields length changed!, fields are",t),void 0!=t.photos)t.photos.map((function(a,o){o>e.photoList.length||t.photos[o]&&V.a.getData(e.photoList[o],(function(){var e=V.a.getTag(this,"DateTimeOriginal");console.log("got exif date for image",e,"applying to index",o),void 0!==e&&function(e,t,a){var o=a.getFieldsValue();console.log("fields are",o,"date is",e);var s=o.photos;Object.assign(s[t],{dt_taken:P(e)}),console.log("updating date at index",t,"fields were",o,"assigning to",{photos:s}),a.setFieldsValue({photos:s})}(function(e){var t=e.split(/\D/);return new Date(t[0],t[1]-1,t[2],t[3],t[4],t[5])}(e),o,s)}))})),i(!1)}}),[void 0!==s.getFieldsValue().photos?s.getFieldsValue().photos.length:null]),Object(I.jsx)("div",{className:"photo-selector",children:Object(I.jsxs)(O.a,{name:"photo-upload-form",onFinish:function(a){return e.handlePhotoSubmit((function(){a.photos.map((function(){return t(0)}))}),a)},form:s,children:[Object(I.jsx)(O.a.Item,{label:"Your Kerberos",name:"uploader",rules:[{required:!0,message:"Kerberos is required"}],children:Object(I.jsx)(p.a,{placeholder:"kerb"})}),Object(I.jsx)(O.a.List,{name:"photos",children:function(a,o){var s=o.add,n=o.remove;return t=function(e){return n(e)},Object(I.jsxs)(I.Fragment,{children:[a.map((function(t){var a=e.photoList[t.key];return console.log("image for key",t.key,"is",a),a?Object(I.jsxs)("div",{className:"image-info-form-container",children:[Object(I.jsx)(S.a,{}),Object(I.jsxs)(J,{level:2,children:["Image ",t.key+1,": ",a.name]}),Object(I.jsx)("img",{src:URL.createObjectURL(a),className:"image-preview"}),Object(I.jsx)(O.a.Item,{label:"Event/Topic",name:[t.key,"event_name"],rules:[{required:!0,message:"Event name is required"}],children:Object(I.jsx)(p.a,{placeholder:"Men's Soccer vs. WPI"})}),Object(I.jsxs)(g.b,{children:[Object(I.jsx)(O.a.Item,{label:"Department",name:[t.key,"department"],initialValue:"fto",rules:[{required:!0,message:"Department is required"}],children:Object(I.jsxs)(D.a,{placeholder:"Select",children:[Object(I.jsx)(z,{value:"spo",children:"SPO"}),Object(I.jsx)(z,{value:"fto",children:"FTO"}),Object(I.jsx)(z,{value:"rtz",children:"RTZ"}),Object(I.jsx)(z,{value:"cl",children:"CL"})]})}),Object(I.jsx)(O.a.Item,{label:"Volume",name:[t.key,"volume"],rules:[{required:!0,message:"Volume # is required"}],initialValue:e.defaultVolume,children:Object(I.jsx)(x.a,{})}),Object(I.jsx)(O.a.Item,{label:"Issue",name:[t.key,"issue"],rules:[{required:!0,message:"Issue # is required"}],initialValue:e.defaultIssue,children:Object(I.jsx)(x.a,{})})]}),Object(I.jsx)(O.a.Item,{label:"Date/Time Taken (autofilled from EXIF if available)",name:[t.key,"dt_taken"],rules:[{required:!0,message:"Date/Time is required"}],children:Object(I.jsx)(_,{showTime:!0})}),Object(I.jsx)(O.a.Item,{label:"Caption",name:[t.key,"caption"],rules:[{required:!0,message:"Caption is required"}],children:Object(I.jsx)(p.a.TextArea,{placeholder:"See the wiki for how to write a good caption"})}),Object(I.jsx)(O.a.Item,{label:"Attribution (or your full name)",name:[t.key,"attribution"],rules:[{required:!0,message:"Attribution is required"}],children:Object(I.jsx)(p.a,{placeholder:"Photo Provided by Dance Troupe"})})]}):Object(I.jsxs)("div",{className:"image-info-form-container",children:[Object(I.jsx)(S.a,{}),Object(I.jsx)(h.a,{}),Object(I.jsx)(S.a,{})]})})),Object(I.jsxs)(O.a.Item,{children:[Object(I.jsx)(S.a,{}),Object(I.jsx)(M,{name:"file",accept:"image/png, image/jpeg",multiple:!0,showUploadList:!1,beforeUpload:function(t,o){return e.addPhotos(o),s(),i(!0),console.log("beforeUpload called for file",t,"fields are now",a),!1},children:"Click or drag to upload files. Please upload JPEG files."})]})]})}}),Object(I.jsx)(v.a,{type:"submit",htmlType:"submit",children:"Submit ".concat(e.photoList.length," Photo").concat(1!=e.photoList.length?"s":"")})]})})}a(290);var B=m.a.Title,G=m.a.Paragraph;m.a.Text,m.a.Link,b.a.Dragger;function K(e){var t=Object(o.useState)([]),a=Object(r.a)(t,2),s=a[0],n=a[1],l=Object(o.useState)([]),u=Object(r.a)(l,2);u[0],u[1];s.map((function(t,a){return Object(I.jsx)(A,{file:t.file,itemNum:a+1,defaultVolume:e.defaultVolume,defaultIssue:e.defaultIssue,handleUpdate:function(e){console.log("Saw update to form in item ".concat(a+1,": ").concat(JSON.stringify(e)));var t=Object(c.a)(s);t[a].info=e,n(t)}},a)}));return Object(I.jsxs)("div",{className:"photo-form",children:[Object(I.jsxs)(m.a,{children:[Object(I.jsx)(B,{children:"The Tech Photo Upload Form"}),Object(I.jsx)(G,{children:"This site is meant to make the process of uploading photos simpler."})]}),Object(I.jsx)(W,{addPhotos:function(e){console.log("adding photos. photoList is",s),n(s.concat(e)),console.log("added",e,"photo list is now",s)},defaultVolume:e.defaultVolume,defaultIssue:e.defaultIssue,photoList:s,handlePhotoSubmit:function(e,t){console.log("submitted photo list to follow",s),console.log("and values",t),console.log("function to call on success",e);var a=s.map((function(e,a){return Object(i.a)(Object(i.a)({},t.photos[a]),{},{uploader:t.uploader,filename:e.name})}));console.log(a),a.forEach((function(t,a){var o="uploading_msg";f.b.loading({content:"Uploading Photo ".concat(a+1,"/").concat(s.length),msg_key:o}),j.post("create_photo",t).then((function(t){console.log("post result"),console.log(t);var l=new FormData;for(var c in t.data.upload_url.fields)l.append(c,t.data.upload_url.fields[c]);l.append("file",s[a]),j.post(t.data.upload_url.url,l,{headers:{"Content-Type":"multipart/form-data"}}).then((function(e){console.log("upload result"),console.log(e),f.b.success({content:"Done uploading ".concat(a+1,"/").concat(s.length,"!"),msg_key:o})})),console.log("calling function to clear fields"),e(),n([])}))}))}})]})}var X=function(){var e=Object(o.useState)([]),t=Object(r.a)(e,2),a=t[0],s=t[1];Object(o.useEffect)((function(){s("form")}),[]);var n=Object(o.useState)([]),l=Object(r.a)(n,2),c=l[0],i=l[1];return Object(o.useEffect)((function(){j.get("photos",{params:{skip:0,limit:1}}).then((function(e){0!=e.data.length?(console.log(e),i({volume:e.data[0].volume,issue:e.data[0].issue}),console.log("got most recent volume and issue"),console.log(e.data[0].volume),console.log(e.data[0].issue)):i({volume:void 0,issue:void 0})}))}),[]),"form"==a?Object(I.jsxs)("div",{className:"main-container",children:[Object(I.jsx)(K,{defaultVolume:c.volume,defaultIssue:c.issue}),Object(I.jsx)("br",{}),Object(I.jsx)("a",{style:{opacity:"25%"},onClick:function(){s("view"),console.log("clicked"),console.log(a)},children:"view all photos"})]}):"view"==a?Object(I.jsx)("div",{className:"main-container",children:Object(I.jsx)(w,{defaultVolume:c.volume,defaultIssue:c.issue})}):Object(I.jsx)("div",{className:"main-container",children:Object(I.jsx)(h.a,{size:"large"})})},Z=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,303)).then((function(t){var a=t.getCLS,o=t.getFID,s=t.getFCP,n=t.getLCP,l=t.getTTFB;a(e),o(e),s(e),n(e),l(e)}))};l.a.render(Object(I.jsx)(s.a.StrictMode,{children:Object(I.jsx)(X,{})}),document.getElementById("root")),Z()}},[[291,1,2]]]);
//# sourceMappingURL=main.563efeb7.chunk.js.map